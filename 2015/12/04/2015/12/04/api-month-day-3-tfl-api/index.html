<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>API Month Day 3 - TFL API | The Bedroom Laboratory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="API purpose: Commuting Data Signup: No Signup Documentation: https://api-portal.tfl.gov.uk/docs Github: https://github.com/gregario/API-Month/tree/master/Day3%20Maps  Comment: surprisingly challenging">
<meta name="keywords" content="API">
<meta property="og:type" content="article">
<meta property="og:title" content="API Month Day 3 - TFL API">
<meta property="og:url" content="http://thebedlab.com/2015/12/04//2015/12/04/api-month-day-3-tfl-api//index.html">
<meta property="og:site_name" content="The Bedroom Laboratory">
<meta property="og:description" content="API purpose: Commuting Data Signup: No Signup Documentation: https://api-portal.tfl.gov.uk/docs Github: https://github.com/gregario/API-Month/tree/master/Day3%20Maps  Comment: surprisingly challenging">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2017-09-21T15:20:23.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="API Month Day 3 - TFL API">
<meta name="twitter:description" content="API purpose: Commuting Data Signup: No Signup Documentation: https://api-portal.tfl.gov.uk/docs Github: https://github.com/gregario/API-Month/tree/master/Day3%20Maps  Comment: surprisingly challenging">
  
    <link rel="alternate" href="/atom.xml" title="The Bedroom Laboratory" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">The Bedroom Laboratory</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">A small apartment leaves little alternative</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://thebedlab.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-/2015/12/04/api-month-day-3-tfl-api/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/04/2015/12/04/api-month-day-3-tfl-api/" class="article-date">
  <time datetime="2015-12-04T17:00:33.000Z" itemprop="datePublished">2015-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      API Month Day 3 - TFL API
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>API purpose: Commuting Data</p>
<p>Signup: No Signup</p>
<p>Documentation: <a href="https://api-portal.tfl.gov.uk/docs" target="_blank" rel="external">https://api-portal.tfl.gov.uk/docs</a></p>
<p>Github: <a href="https://github.com/gregario/API-Month/tree/master/Day3%20Maps" target="_blank" rel="external">https://github.com/gregario/API-Month/tree/master/Day3%20Maps </a> Comment: surprisingly challenging</p>
<p>So as I said yesterday today I want to find the arrival time of my local train so I can plan my morning breakfast intake! It turned out to be quite challenging… Firstly a comment on the TFL (transport for london) API services. They’re all over the place. I found the following resources to extract data about journeys, stop locations and times:</p>
<p><a href="https://api.tfl.gov.uk/#Journey" target="_blank" rel="external">https://api.tfl.gov.uk/#Journey</a></p>
<p><a href="http://countdown.tfl.gov.uk/" target="_blank" rel="external">http://countdown.tfl.gov.uk/</a></p>
<p>and two sets of documentation at:</p>
<p><a href="https://api-portal.tfl.gov.uk/docs" target="_blank" rel="external">https://api-portal.tfl.gov.uk/docs</a></p>
<p><a href="https://api.tfl.gov.uk/" target="_blank" rel="external">https://api.tfl.gov.uk/</a></p>
<p>So I eventually used the API portal to get access to arrival times, it wasn’t the most straightforward information set to work with however. Check out the photo!</p>
<p><a href="/wp-content/uploads/2015/12/JSON_TFL.jpg">JSON_TFL</a></p>
<p>The photo shows a typical API response from a station arrival time call. We want one variable from this giant list! This is a good time to work with a list like this as many API’s are complex like this one so it gives me an opportunity to go through the detail and figure out how to extract the data.</p>
<p>I got to play with some good stuff here such as operating on, iterating over and extracting conditional data from JSON objects. Also doing operations on time while pulling the current real time from the python datetime module.</p>
<p>The key for the code here is that the API is a list where each element in the list is a JSON object (that we manipulate as a python dict). Confused? I was… But its OK to work with in practice. What happens here is we write some code to loop through the list and for every JSON element in the list do a value search for arrival time. This gives us the arrival time of all trains into my station. However I only want certain trains heading in one direction. So I run an if with the loop checking for the relevant trains. If they are present pop the arrival time from that train into a new array. Then we have an array with all the relevant arrival times. Just sort that and you have the train that will arrive first. Pop that out and you have a variable to work with. YAY. Taking that from the current time gives you the number you are looking for.</p>
<p>I’ve explained the logic of what I want to do now let’s look at the code. If you are reading this (I do doubt anyone is) I am trying to improve the way in which I write these tutorials. Today I’m trying to explain how all the code works as comments. Hopefully one can understand how it works just from that.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># Program to check how long it will take me to get to work</span></div><div class="line"><span class="comment"># Greg Jackson 1st dev 2015</span></div><div class="line"><span class="comment"># Twitter @gr3gario or github gregario</span></div><div class="line"><span class="comment"># Day one of the Month of API</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> json </div><div class="line"><span class="keyword">import</span> sys <span class="comment"># needed to pass arguments from command line </span></div><div class="line"><span class="keyword">import</span> datetime </div><div class="line"></div><div class="line">url = <span class="string">"https://api.tfl.gov.uk/StopPoint/910grctryrd/arrivals"</span> <span class="comment"># the stop number is returned from the TFL website from a manual search. This calls the data</span></div><div class="line">r = requests.get(url).json() <span class="comment"># Make a request to the TFL API for data</span></div><div class="line">time = [] <span class="comment"># List for my future train arrivals</span></div><div class="line"><span class="keyword">for</span> key <span class="keyword">in</span> r: <span class="comment"># the returned object is a list with nested JSON objects inside each list. So you need to iterate through the list and do operations on each object separately</span></div><div class="line">	<span class="keyword">if</span> key[<span class="string">'destinationName'</span>] == (<span class="string">"Cheshunt Rail Station"</span>) <span class="keyword">or</span> (<span class="string">"Enfield Town Rail Station"</span>): <span class="comment"># This filters out trains to different destinations. I can take either of these trains</span></div><div class="line">		time.append(key[<span class="string">'expectedArrival'</span>])  <span class="comment"># Adds expected arrival time from each train data structure to the time list</span></div><div class="line"></div><div class="line">time_sorted = sorted(time) <span class="comment"># sorts the time list so we get the train due to arrive first</span></div><div class="line">time_train = time_sorted.pop(<span class="number">0</span>) <span class="comment"># pops out the first train to arrive and stores as a string</span></div><div class="line">§</div><div class="line"></div><div class="line"><span class="comment"># this translates the time from a string in the list to a usable string, taking out the date. </span></div><div class="line"><span class="comment"># A note on how I deal with the date and time operations here. </span></div><div class="line"><span class="comment"># Its TERRIBLE. it works but I'm sure there's a much cleaner way of doing this. </span></div><div class="line">time_train_temp = time_train.split(<span class="string">'T'</span>,<span class="number">1</span>)[<span class="number">-1</span>]</div><div class="line">time_train_parsed = time_train_temp.split(<span class="string">'.'</span>,<span class="number">1</span>)[<span class="number">0</span>]</div><div class="line"></div><div class="line">current_time = str(datetime.datetime.now())</div><div class="line">current_time_temp = current_time.split(<span class="string">' '</span>,<span class="number">1</span>)[<span class="number">-1</span>]</div><div class="line">current_time_parsed = current_time_temp.split(<span class="string">'.'</span>,<span class="number">1</span>)[<span class="number">0</span>]</div><div class="line"><span class="comment">#print  k</span></div><div class="line"></div><div class="line"><span class="comment"># Converts the two hour:minute:second strings back into time variables. </span></div><div class="line">timeA = datetime.datetime.strptime(time_train_parsed, <span class="string">'%H:%M:%S'</span>)  </div><div class="line">timeB = datetime.datetime.strptime(current_time_parsed, <span class="string">'%H:%M:%S'</span>) </div><div class="line"></div><div class="line"><span class="comment"># Takes the time of the next train away from the current time to give an estimated time until arrival of the next train I can take </span></div><div class="line">time_delta = timeA-timeB</div><div class="line"><span class="keyword">print</span> (<span class="string">"The next train to work will arrive in "</span> +str(time_delta))</div></pre></td></tr></table></figure>
<p>And it works!</p>
<p><a href="/wp-content/uploads/2015/12/Output_day3.jpg">Output_day3</a></p>
<p>I’ve never been so happy to see some command line arguments! This was day three but I ran over time so I’m going to immediately do day 4 too 🙂 Stay tuned.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/04/2015/12/04/api-month-day-3-tfl-api/" data-id="cj7ulv36f002wutnpi69l4905" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/12/04/2015/12/04/day-4-api-month-google-maps-geocoding/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Day 4 API Month - Google Maps Geocoding
        
      </div>
    </a>
  
  
    <a href="/2015/12/02/2015/12/02/api-month-day-2-weather-underground/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">API Month Day 2 - Weather Underground</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/Projects/">Projects</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maker/">Maker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Projects/">Projects</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Projects/School-Night-Sessions/">School Night Sessions</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Projects/Tutorials/">Tutorials</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/School-Night-Sessions/">School Night Sessions</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/The-Lab/">The Lab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorials/">Tutorials</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorised/">Uncategorised</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/API/">API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Arduino/">Arduino</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Beginner/">Beginner</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Digital-Week/">Digital Week</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Doodlebot/">Doodlebot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Drinking/">Drinking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ESP8266/">ESP8266</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Homebrew/">Homebrew</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IoT/">IoT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lasercutter/">Lasercutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Month/">Month</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REST-API/">REST API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reflow-Soldering-Oven/">Reflow Soldering Oven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Workshop/">Workshop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homemade-equipment/">homemade equipment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/API/" style="font-size: 20px;">API</a> <a href="/tags/Arduino/" style="font-size: 13.33px;">Arduino</a> <a href="/tags/Beginner/" style="font-size: 13.33px;">Beginner</a> <a href="/tags/Digital-Week/" style="font-size: 16.67px;">Digital Week</a> <a href="/tags/Doodlebot/" style="font-size: 10px;">Doodlebot</a> <a href="/tags/Drinking/" style="font-size: 10px;">Drinking</a> <a href="/tags/ESP8266/" style="font-size: 10px;">ESP8266</a> <a href="/tags/Homebrew/" style="font-size: 10px;">Homebrew</a> <a href="/tags/IoT/" style="font-size: 10px;">IoT</a> <a href="/tags/Lasercutter/" style="font-size: 10px;">Lasercutter</a> <a href="/tags/Month/" style="font-size: 10px;">Month</a> <a href="/tags/REST-API/" style="font-size: 10px;">REST API</a> <a href="/tags/Reflow-Soldering-Oven/" style="font-size: 10px;">Reflow Soldering Oven</a> <a href="/tags/Workshop/" style="font-size: 16.67px;">Workshop</a> <a href="/tags/homemade-equipment/" style="font-size: 10px;">homemade equipment</a> <a href="/tags/tutorial/" style="font-size: 16.67px;">tutorial</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/06/07/api-month-day-11-movies/">API Month Day 11 - Movies</a>
          </li>
        
          <li>
            <a href="/2015/12/10/api-month-day-10-twitter-mood/">API Month Day 10 - Oasis or Blur</a>
          </li>
        
          <li>
            <a href="/2015/12/09/2015/12/09/api-month-day-9-petrol-stations/">API Month Day 9 - Petrol Stations</a>
          </li>
        
          <li>
            <a href="/2015/12/08/2015/12/08/api-month-day-8-space/">API Month Day 8 - SPACE</a>
          </li>
        
          <li>
            <a href="/2015/12/07/2015/12/07/api-month-day-7-where-is-my-air/">API Month Day 7 - Where is my air?</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 The Bedroom Laboratory<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
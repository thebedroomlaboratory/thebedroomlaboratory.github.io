<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Day 5 API Month - London Air Quality | The Bedroom Laboratory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="API purpose: Getting London Air Quality Data Signup: None, its open data Documentation: http://api.erg.kcl.ac.uk/AirQuality/help Github: https://github.com/gregario/API-Month/tree/master/Day5%20AirQua">
<meta name="keywords" content="API">
<meta property="og:type" content="article">
<meta property="og:title" content="Day 5 API Month - London Air Quality">
<meta property="og:url" content="http://thebedlab.com/2015/12/05//2015/12/05/day-5-api-month-london-air-quality//index.html">
<meta property="og:site_name" content="The Bedroom Laboratory">
<meta property="og:description" content="API purpose: Getting London Air Quality Data Signup: None, its open data Documentation: http://api.erg.kcl.ac.uk/AirQuality/help Github: https://github.com/gregario/API-Month/tree/master/Day5%20AirQua">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2017-09-21T15:20:23.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Day 5 API Month - London Air Quality">
<meta name="twitter:description" content="API purpose: Getting London Air Quality Data Signup: None, its open data Documentation: http://api.erg.kcl.ac.uk/AirQuality/help Github: https://github.com/gregario/API-Month/tree/master/Day5%20AirQua">
  
    <link rel="alternate" href="/atom.xml" title="The Bedroom Laboratory" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">The Bedroom Laboratory</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">A small apartment leaves little alternative</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://thebedlab.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-/2015/12/05/day-5-api-month-london-air-quality/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/05/2015/12/05/day-5-api-month-london-air-quality/" class="article-date">
  <time datetime="2015-12-05T16:48:47.000Z" itemprop="datePublished">2015-12-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Day 5 API Month - London Air Quality
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>API purpose: Getting London Air Quality Data</p>
<p>Signup: None, its open data</p>
<p>Documentation: <a href="http://api.erg.kcl.ac.uk/AirQuality/help" target="_blank" rel="external">http://api.erg.kcl.ac.uk/AirQuality/help</a></p>
<p>Github: <a href="https://github.com/gregario/API-Month/tree/master/Day5%20AirQuality" target="_blank" rel="external">https://github.com/gregario/API-Month/tree/master/Day5%20AirQuality</a></p>
<p>Comment: Really well made API, not real time though, about a day delay</p>
<p>So Kings College run an array of air quality monitors across London. Its a really interesting piece of data to work with that is so relevant to our day to day lives. Thought I would have a look at the API and try to pull the data from my nearest air quality monitor to my home.</p>
<p>The call from the API documentation requires the use of their site codes to work, which isn’t the most intuitive. A quick peruse of the maps at <a href="http://www.londonair.org.uk/LondonAir/Default.aspx" target="_blank" rel="external">particulate matter</a>. Cool so IS2 is my air quality roadside monitor. As a bonus there’s 15 years of data from the monitor.</p>
<p>So <a href="http://api.erg.kcl.ac.uk/AirQuality/help/operations/GetRawDataSitesSpeciesJSON" target="_blank" rel="external">here</a> is the link to the call we want. It actually leads to a pretty straightforward script. [Edit an hour later]. Getting strings converted to floats is apparently not straight forward. Anywho, here’s the completed script. As always I explain the crap out of the code in the code so I think it kind of explains itself!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#coding: utf-8</span></div><div class="line"><span class="comment"># Day 5 of month of API</span></div><div class="line"><span class="comment"># Looking at local air quality data and what the last 24 hours have been like in your local area</span></div><div class="line"><span class="comment"># Greg Jackson 05/12/15 gr3gario on twitter ang gregario on github</span></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> json </div><div class="line"></div><div class="line"></div><div class="line">url = <span class="string">"http://api.erg.kcl.ac.uk/AirQuality/Data/SiteSpecies/SiteCode=IS2/SpeciesCode=NO2/StartDate=04-12-15/EndDate=05-12-15/Json"</span> <span class="comment"># Gives data in closest AQ monitor</span></div><div class="line">r = requests.get(url).json() <span class="comment"># Make a request to the LAQN API for data</span></div><div class="line"></div><div class="line">rLoop = r[<span class="string">'RawAQData'</span>][<span class="string">'Data'</span>] <span class="comment"># You got to define this here as you can't nest it below. the for loop below only works for the list embedded in the JSON object</span></div><div class="line">AQugm3 = [] <span class="comment"># A list to store the readins</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">for</span> key <span class="keyword">in</span> rLoop:</div><div class="line">	AQugm3temp = key[<span class="string">'@Value'</span>] <span class="comment"># This loops through each data packet in the list and pulls out our relevant datapoint</span></div><div class="line">	<span class="keyword">try</span>: <span class="comment"># A try catch is included here as there are blank datapoints returned from the LAQN API that would mess this up occasionally if there wasn't a catch in place</span></div><div class="line">		AQugm3temp = float(AQugm3temp) <span class="comment"># Converts from a string to a float so we can perform operations on it</span></div><div class="line">		AQugm3.append(AQugm3temp) <span class="comment"># Adds output to AQugm3 variable</span></div><div class="line">	<span class="comment"># Catches exceptions</span></div><div class="line">	<span class="keyword">except</span>:</div><div class="line">		<span class="keyword">print</span> <span class="string">'error in parsing, oops'</span></div><div class="line">		<span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="comment"># Really simple averages. Sums all elements in the list and divides by the length of the list </span></div><div class="line">average = sum(AQugm3) / float(len(AQugm3))</div><div class="line">average = round(average,<span class="number">2</span>)</div><div class="line"><span class="comment"># This is an EU defined goal for NO2 in the city. I figure if our daily average is below this we're doing well. Its more to give context to the number.</span></div><div class="line">goal = <span class="number">40.0</span> </div><div class="line"></div><div class="line"><span class="comment"># Simple check to give context to the number. </span></div><div class="line"><span class="keyword">if</span> average &lt; goal:</div><div class="line">	<span class="keyword">print</span> <span class="string">"Hurray! The air quality today is less than the yearly average target of 40 ug/m3 NO2 target in the UK and reads "</span> +str(average)+ <span class="string">" ug/m3"</span></div><div class="line"><span class="keyword">elif</span> average &gt; goal: </div><div class="line">	<span class="keyword">print</span> <span class="string">"Unfortunately the air quality today is more than the yearly average target of 40 ug/m3 NO2 in the UK and reads "</span> + str(average)+ <span class="string">" ug/m3"</span></div></pre></td></tr></table></figure>
<p>So when I run python AQ.py.</p>
<blockquote>
<p>Unfortunately the air quality today is more than the yearly average target of 40 ug/m3 NO2 in the UK and reads 69.71 ug/m3</p>
</blockquote>
<p>Interesting stuff 🙂</p>
<p>So I had the thought of making a bigger project at the end of each week, not necessarily more work but wrapping up the work I’ve done into one bigger program. I have a good idea to wrap this weeks work up which I’ll explain on Monday but its missing one big element. I need to be able to easily calculate the distance between two sets of GPS coordinates. So tomorrow I’ll work on this. I’ll be pulling an address in the UK, converting to GPS data and checking its linear distance to tower bridge in London.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/05/2015/12/05/day-5-api-month-london-air-quality/" data-id="cj7ulv36k0039utnp9052azfy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/12/06/2015/12/06/day-6-api-month-gps-distance/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Day 6 API Month - GPS Distance
        
      </div>
    </a>
  
  
    <a href="/2015/12/04/2015/12/04/day-4-api-month-google-maps-geocoding/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Day 4 API Month - Google Maps Geocoding</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/Projects/">Projects</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maker/">Maker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Projects/">Projects</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Projects/School-Night-Sessions/">School Night Sessions</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Projects/Tutorials/">Tutorials</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/School-Night-Sessions/">School Night Sessions</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/The-Lab/">The Lab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorials/">Tutorials</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorised/">Uncategorised</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/API/">API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Arduino/">Arduino</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Beginner/">Beginner</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Digital-Week/">Digital Week</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Doodlebot/">Doodlebot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Drinking/">Drinking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ESP8266/">ESP8266</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Homebrew/">Homebrew</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IoT/">IoT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lasercutter/">Lasercutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Month/">Month</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REST-API/">REST API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reflow-Soldering-Oven/">Reflow Soldering Oven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Workshop/">Workshop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homemade-equipment/">homemade equipment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/API/" style="font-size: 20px;">API</a> <a href="/tags/Arduino/" style="font-size: 13.33px;">Arduino</a> <a href="/tags/Beginner/" style="font-size: 13.33px;">Beginner</a> <a href="/tags/Digital-Week/" style="font-size: 16.67px;">Digital Week</a> <a href="/tags/Doodlebot/" style="font-size: 10px;">Doodlebot</a> <a href="/tags/Drinking/" style="font-size: 10px;">Drinking</a> <a href="/tags/ESP8266/" style="font-size: 10px;">ESP8266</a> <a href="/tags/Homebrew/" style="font-size: 10px;">Homebrew</a> <a href="/tags/IoT/" style="font-size: 10px;">IoT</a> <a href="/tags/Lasercutter/" style="font-size: 10px;">Lasercutter</a> <a href="/tags/Month/" style="font-size: 10px;">Month</a> <a href="/tags/REST-API/" style="font-size: 10px;">REST API</a> <a href="/tags/Reflow-Soldering-Oven/" style="font-size: 10px;">Reflow Soldering Oven</a> <a href="/tags/Workshop/" style="font-size: 16.67px;">Workshop</a> <a href="/tags/homemade-equipment/" style="font-size: 10px;">homemade equipment</a> <a href="/tags/tutorial/" style="font-size: 16.67px;">tutorial</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/06/07/api-month-day-11-movies/">API Month Day 11 - Movies</a>
          </li>
        
          <li>
            <a href="/2015/12/10/api-month-day-10-twitter-mood/">API Month Day 10 - Oasis or Blur</a>
          </li>
        
          <li>
            <a href="/2015/12/09/2015/12/09/api-month-day-9-petrol-stations/">API Month Day 9 - Petrol Stations</a>
          </li>
        
          <li>
            <a href="/2015/12/08/2015/12/08/api-month-day-8-space/">API Month Day 8 - SPACE</a>
          </li>
        
          <li>
            <a href="/2015/12/07/2015/12/07/api-month-day-7-where-is-my-air/">API Month Day 7 - Where is my air?</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 The Bedroom Laboratory<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
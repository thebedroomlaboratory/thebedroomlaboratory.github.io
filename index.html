<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>The Bedroom Laboratory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="The Bedroom Laboratory">
<meta property="og:url" content="http://thebedlab.com/index.html">
<meta property="og:site_name" content="The Bedroom Laboratory">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The Bedroom Laboratory">
  
    <link rel="alternate" href="/atom.xml" title="The Bedroom Laboratory" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">The Bedroom Laboratory</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">A small apartment leaves little alternative</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://thebedlab.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-api-month-day-11-movies" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/06/07/api-month-day-11-movies/" class="article-date">
  <time datetime="2016-06-07T16:36:55.000Z" itemprop="datePublished">2016-06-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/07/api-month-day-11-movies/">API Month Day 11 - Movies</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="/wp-content/uploads/2015/11/API.png">API.png</a></p>
<p><strong>API purpose</strong> Interfacing and searching IMDB database</p>
<p><strong>Signup</strong> not needed</p>
<p><strong>Documentation</strong> <a href="http://www.omdbapi.com/" target="_blank" rel="external">http://www.omdbapi.com/</a></p>
<p><strong>Github</strong> <a href="https://github.com/gregario/API-Month/tree/master/Day11%20Movies" target="_blank" rel="external">Click here for link</a></p>
<p><strong>Comment</strong> Surprisingly fun game</p>
<p>So I went to a games night last night to decide who got what teams for the upcoming Euros 2016. I do live an exciting life. Anywho we play a game sometimes where you pick a number in days, hours and minutes and have to name 3 boxsets of popular TV that would get you there.</p>
<p>We found some inconsistencies (and were running out of games) so I had a quick look at the omdbapi (open movie database API) to see how the data was being gathered. I found a quick call that would return the IMDB ratings of movies so I whipped up a quick script to calculate the sum of an arbitrary number of movies.</p>
<p>See attached  link in the header for the source. It’s very short and is a pretty standard requests format if you’ve seen any of my other posts. The one style change I made was to use raw_input() instead of a sys.argv() to pass arguments to the script. It’s a lot neater and more flexible for the sort of scripts I’ve been writing so I think I’ll change to using it in the future.</p>
<p>I also won that round …;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2016/06/07/api-month-day-11-movies/" data-id="cj7ulv36r003nutnpyz18g1h5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Month/">Month</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-api-month-day-10-twitter-mood" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/10/api-month-day-10-twitter-mood/" class="article-date">
  <time datetime="2015-12-10T14:03:25.000Z" itemprop="datePublished">2015-12-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/10/api-month-day-10-twitter-mood/">API Month Day 10 - Oasis or Blur</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="/wp-content/uploads/2015/12/oasisorblur.jpg">oasisorblur</a></p>
<p><strong>API purpose</strong> Interfacing and searching twitter</p>
<p><strong>Signup</strong> <a href="https://dev.twitter.com/apps/new" target="_blank" rel="external">https://dev.twitter.com/apps/new</a></p>
<p><strong>Documentation</strong> <a href="https://dev.twitter.com/rest/public" target="_blank" rel="external">https://dev.twitter.com/rest/public</a></p>
<p><strong>Github</strong> <a href="https://github.com/gregario/API-Month/tree/master/Day10%20Twitter" target="_blank" rel="external">Click here for link</a></p>
<p><strong>Comment</strong> So much that could be done with this</p>
<p>Today is so easy. After reading into the Twitter API it became obvious that people had written so much on this subject. So to get started you do the following.</p>
<p>After running</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">easy_install twitter</div></pre></td></tr></table></figure>
<p>Just look at this resource: <a href="https://github.com/ideoforms/python-twitter-examples" target="_blank" rel="external">https://github.com/ideoforms/python-twitter-examples </a></p>
<p>It’s so good, gives examples for searching by hashtag (both as a sample or from the streaming service), searching by area, posting to your feed and doing a bunch of general analytics.</p>
<p>Make sure you have installed twitter tools (via the above command) and not python-twitter which is a separate set of tools. This lead to a bit of confusion on my part. I wrote a simple app that searches hashtags for Oasis and Blur to answer the age old question once and for all. Enjoy!</p>
<p>Apparently it’s Blur!</p>
<p><a href="/wp-content/uploads/2015/12/Day10Output.jpg">Day10</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/10/api-month-day-10-twitter-mood/" data-id="cj7ulv36p003jutnpmiabbk1o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-/2015/12/09/api-month-day-9-petrol-stations/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/09/2015/12/09/api-month-day-9-petrol-stations/" class="article-date">
  <time datetime="2015-12-09T15:22:16.000Z" itemprop="datePublished">2015-12-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/09/2015/12/09/api-month-day-9-petrol-stations/">API Month Day 9 - Petrol Stations</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>API purpose</strong> Interfacing and searching google maps</p>
<p><strong>Signup</strong> Via your google account</p>
<p><strong>Documentation</strong> <a href="https://developers.google.com/places/" target="_blank" rel="external">Click here for link</a></p>
<p><strong>Comment</strong> So much that could be done with this</p>
<p>Today I wanted to play with the google places API. Its very cool, it lets you search within a distance of your current location for various services. Pretty cool to see from this what’s around you. You can even pull out reviews from the locations!</p>
<p>So I wrote a script that takes in an address and checks for nearby petrol stations. Nice little function that could easily be extended to take in any service in your area from user input.</p>
<p>Nothing too tricky today, but it turns out there are not very many petrol stations in my area. I did change the argv input to a raw_input prompt from the user, its a little bit nicer and means you can be dynamically prompted for inputs during the programs operation without having to build a GUI. This can be used later to build simple command line menus etc…</p>
<p>Here is an example output from the script:</p>
<p><a href="/wp-content/uploads/2015/12/Day9Output.jpg">Day9Output</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/09/2015/12/09/api-month-day-9-petrol-stations/" data-id="cj7ulv36o003gutnpcq3maspl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-/2015/12/08/api-month-day-8-space/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/08/2015/12/08/api-month-day-8-space/" class="article-date">
  <time datetime="2015-12-08T13:29:51.000Z" itemprop="datePublished">2015-12-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/08/2015/12/08/api-month-day-8-space/">API Month Day 8 - SPACE</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>API purpose</strong> Finding information about the International Space Station</p>
<p><strong>Signup</strong> No signup necessary</p>
<p><strong>Documentation</strong> <a href="http://open-notify.org/Open-Notify-API/" target="_blank" rel="external">http://open-notify.org/Open-Notify-API/</a></p>
<p><strong>Github</strong> <a href="https://github.com/gregario/API-Month/tree/master/Day8%20International%20Space%20Station" target="_blank" rel="external">Click here for link</a></p>
<p><strong>Comment</strong> Really fun dataset to play with</p>
<p>I did promise some time manipulation stuff today  but it was super boringso I got interested in space instead. Fellow bedlabber (that’s a word) vykta sent on a link to Urethcast, a service which provides pictures from the International Space Station (ISS). He’s promised to write up a post on it this month so stay tuned for that. It did get me thinking about what other sources of open data are available from the ISS.</p>
<p>I did some googling and found open-notify, a wrapper API for some of the data Nasa puts out. Turns out space agencies have a good understanding of where the ISS is at any given time, who would have thought? Open-notify provides information on where the ISS is, when it will be visible over a given GPS coordinates and who is on board. All cool stuff 🙂</p>
<p>It did give me the opportunity to implement a few things:</p>
<ul>
<li><p>Epoch converter, epoch time (or unix time) is time quoted in seconds since 00:00:00 UTC on Thursday, 1 January 1970. Its useful for comparing times on servers but is not very human readable.</p>
</li>
<li><p>Reverse geocoding, for if I got a set of GPS coordinates and want a real address, I’ve made a function for that now</p>
</li>
</ul>
<p>Its a nice little script, returns a little table of data like so:</p>
<p><a href="/wp-content/uploads/2015/12/Day8-Output.png">Day8 Output</a></p>
<p>I also realised I’ve been consistently spelling longitude incorrectly all week for my variables. Oh well. Check out the code, again its all commented so hopefully is understandable. Any questions pop them in the comments.</p>
<p>All the code is on the github. I’ve realised that its not exactly readable without the indents now that my programs are more complex. I’ll have a read on the wordpress nexus to see how its done and maybe only copy the interesting bits from now on.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/08/2015/12/08/api-month-day-8-space/" data-id="cj7ulv36m003dutnp9lr66dir" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-/2015/12/07/api-month-day-7-where-is-my-air/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/07/2015/12/07/api-month-day-7-where-is-my-air/" class="article-date">
  <time datetime="2015-12-07T15:03:47.000Z" itemprop="datePublished">2015-12-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/07/2015/12/07/api-month-day-7-where-is-my-air/">API Month Day 7 - Where is my air?</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>API purpose: Finding local air quality from address</p>
<p>Signup: air quality has no signup google, as always, does.</p>
<p>Documentation: <a href="https://developers.google.com/maps/web-services/client-library" target="_blank" rel="external">https://developers.google.com/maps/web-services/client-library</a></p>
<p>Github: <a href="https://github.com/gregario/API-Month/tree/master/Day7%20AQ%20Project" target="_blank" rel="external">https://github.com/gregario/API-Month/tree/master/Day7%20AQ%20Project</a></p>
<p>Comment: Wrapping up the first week into a useful script</p>
<p>So today was a culmination of all the learnings I achieved this week…. A bit of background on this one. I decided to do something a bit more abitious today. Since I now have the basic building blocks of data for getting and manipulating JSON API data I thought I would put it to the test for something more than one localised test. So today I’m going to build something chunkier. Using the work I’ve done all week from data manipulation, geocaching and the air quality API, I want to build an app that if you put in a post code in London it finds the nearest AQ monitor from the list and returns its air quality data.</p>
<p>This is more challenging than it sounds, the basic work flow would be.</p>
<p>Take input address and convert to GPS. Pull down list of all London Air Quality monitors and extract their locations. Do a diff between the two to find the closest distance from that new list. Then from that new list pull down a list of sensors associated with that sensor. Then from this pull down their data and average it for the day.</p>
<p>What I can then use this to do is to give Air quality information as an extension to map or location searches. An interesting wrapper library for future work. I’m going to try some more complex error handling in this too, as I’ve been pretty lax with this up until now.</p>
<p>As I’ve moved onto commenting inline the code should be self explanatory, it produces some nice pretty outputs too!</p>
<p><a href="wp-content/uploads/2015/12/Screenshot-2015-12-07-12.29.20.png">Screenshot</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#coding: utf-8</span></div><div class="line"><span class="comment"># Day seven of the month of API</span></div><div class="line"><span class="comment"># Today finds your nearest Air Quality monitor and returns its data</span></div><div class="line"><span class="comment"># Greg Jackson @gr3gario on twitter and gregario on github</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> json </div><div class="line"><span class="keyword">import</span> sys  </div><div class="line"><span class="keyword">import</span> googlemaps</div><div class="line"><span class="keyword">from</span> APIKEY <span class="keyword">import</span> googlekey</div><div class="line"><span class="keyword">import</span> math</div><div class="line"></div><div class="line"><span class="comment">## Workflow</span></div><div class="line"><span class="comment">#Pull down list of all London Air Quality monitors and extract their locations. </span></div><div class="line"><span class="comment">#Do a diff between the two to find the closest distance from that new list.</span></div><div class="line"><span class="comment">#Then from that monitor pull out its air quality monitor. </span></div><div class="line"></div><div class="line"><span class="comment"># This function takes in a command line post code (or address), performs a google maps call to check its GPS data and returns as a list</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">addtoGPS</span><span class="params">()</span>:</span></div><div class="line">	attempts = <span class="number">0</span></div><div class="line">	latlng = []</div><div class="line">	</div><div class="line">	<span class="keyword">while</span> attempts &lt; <span class="number">3</span>:</div><div class="line">		<span class="keyword">try</span>:</div><div class="line">			gmaps = googlemaps.Client(key=googlekey) <span class="comment"># Get key from your google developer portal. </span></div><div class="line">			<span class="comment"># Geocoding an address</span></div><div class="line">			geocode_result = gmaps.geocode(sys.argv[<span class="number">1</span>]) <span class="comment"># passes address given on command line to google maps geocoding api</span></div><div class="line">			</div><div class="line">			<span class="keyword">for</span> key <span class="keyword">in</span> geocode_result: <span class="comment"># the returned object is a list with nested JSON objects inside each list. So you need to iterate through the list and do operations on each object separately</span></div><div class="line">				latlng.append(float(key[<span class="string">'geometry'</span>][<span class="string">'bounds'</span>][<span class="string">'northeast'</span>][<span class="string">'lat'</span>])) <span class="comment"># pulls out nested latitude figure from call</span></div><div class="line">				latlng.append(float(key[<span class="string">'geometry'</span>][<span class="string">'bounds'</span>][<span class="string">'northeast'</span>][<span class="string">'lng'</span>])) <span class="comment"># pulls out nested longditude figure from call</span></div><div class="line">			<span class="keyword">break</span></div><div class="line">		</div><div class="line">		<span class="keyword">except</span>:</div><div class="line">			attempts += <span class="number">1</span></div><div class="line">			<span class="keyword">print</span> <span class="string">"Error getting data from Google maps API"</span>	</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> latlng</div><div class="line"></div><div class="line"><span class="comment"># This function calls the London Air Quality API and returns a list of all the sites with their GPS Coordinates </span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">LAQNList</span><span class="params">()</span>:</span></div><div class="line">	url = <span class="string">"http://api.erg.kcl.ac.uk/AirQuality/Information/MonitoringSites/GroupName=All/JSON"</span> <span class="comment"># Gives all units in London for AQ</span></div><div class="line">	siteDetails=[]</div><div class="line">	siteDetail=&#123;&#125;</div><div class="line">	attempts=<span class="number">0</span></div><div class="line">	distance = <span class="number">0.0</span></div><div class="line"></div><div class="line">	<span class="keyword">while</span> attempts &lt; <span class="number">3</span>:</div><div class="line">		<span class="keyword">try</span>: </div><div class="line">			r = requests.get(url).json() <span class="comment"># Make a request to the TFL API for data</span></div><div class="line">			q = r[<span class="string">'Sites'</span>][<span class="string">'Site'</span>] <span class="comment"># This extracts the list from the JSON object</span></div><div class="line"></div><div class="line">			<span class="keyword">for</span> key <span class="keyword">in</span> q:</div><div class="line">				<span class="comment"># This is quite elegant. There are closed air quality units on the system which we want to ignore. So we check the dateclosed field. If its emply we include the unit. </span></div><div class="line">				dateclosed = key [<span class="string">'@DateClosed'</span>] </div><div class="line">				<span class="keyword">if</span> <span class="keyword">not</span> dateclosed: </div><div class="line">					sitecode = key[<span class="string">'@SiteCode'</span>]</div><div class="line">					latitude = float(key[<span class="string">'@Latitude'</span>])</div><div class="line">					longditude = float(key[<span class="string">'@Longitude'</span>])</div><div class="line">					siteDetail=&#123;<span class="string">'sitecode'</span>: sitecode, <span class="string">'latitude'</span>: latitude, <span class="string">'longditude'</span>: longditude, <span class="string">'distance'</span>:distance&#125;</div><div class="line">					siteDetails.append(siteDetail)</div><div class="line">			<span class="keyword">break</span></div><div class="line"></div><div class="line">		<span class="keyword">except</span>:</div><div class="line">			attempts += <span class="number">1</span></div><div class="line">			<span class="comment">#print "Error getting Location data from LAQN API"</span></div><div class="line"></div><div class="line">	<span class="keyword">return</span> siteDetails</div><div class="line"></div><div class="line"><span class="comment"># This function takes input values and calculates distance for every point and calculates the closest site code</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">distance</span><span class="params">()</span>:</span></div><div class="line">    latlngin = addtoGPS()</div><div class="line">    siteDetails=LAQNList()</div><div class="line">    distance = []</div><div class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> siteDetails:</div><div class="line">    	lat = float(key [<span class="string">'latitude'</span>])</div><div class="line">    	lng = float(key [<span class="string">'longditude'</span>])</div><div class="line">    	output = math.sqrt((latlngin[<span class="number">0</span>] - lat)**<span class="number">2</span> + (latlngin[<span class="number">1</span>] - lng)**<span class="number">2</span>)</div><div class="line">    	key[<span class="string">'distance'</span>] = output</div><div class="line">    	distance.append(output)</div><div class="line"></div><div class="line">    mindistance = min(distance)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> siteDetails:</div><div class="line">    	check = key[<span class="string">'distance'</span>]</div><div class="line">    	<span class="keyword">if</span> check == mindistance: </div><div class="line">    		finalsite = key[<span class="string">'sitecode'</span>]</div><div class="line"></div><div class="line">    <span class="keyword">return</span> finalsite</div><div class="line"></div><div class="line"><span class="comment">## I now have my closest Air Quality Monitor, need to call this and see what sensors it has</span></div><div class="line"><span class="comment">## back to the API documentation</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">whatSensor</span><span class="params">()</span>:</span></div><div class="line">	siteCode = distance()</div><div class="line">	speciesCode = []</div><div class="line">	attempts = <span class="number">0</span> </div><div class="line"></div><div class="line">	</div><div class="line">	<span class="keyword">while</span> attempts &lt; <span class="number">3</span>:</div><div class="line">		<span class="keyword">try</span>: </div><div class="line">			url= <span class="string">"http://api.erg.kcl.ac.uk/AirQuality/Daily/MonitoringIndex/Latest/SiteCode="</span> +siteCode+ <span class="string">"/json"</span></div><div class="line">			r = requests.get(url).json() <span class="comment"># Make a request to the TFL API for data</span></div><div class="line">			q = r[<span class="string">'DailyAirQualityIndex'</span>][<span class="string">'LocalAuthority'</span>][<span class="string">'Site'</span>][<span class="string">'Species'</span>] <span class="comment"># This extracts the list from the JSON object</span></div><div class="line">			<span class="keyword">for</span> key <span class="keyword">in</span> q:</div><div class="line">				specie = key[<span class="string">'@SpeciesCode'</span>]</div><div class="line">				species=&#123;<span class="string">'SpeciesCode'</span>: specie&#125;</div><div class="line">				speciesCode.append(species)</div><div class="line">			<span class="keyword">break</span></div><div class="line"></div><div class="line">		<span class="keyword">except</span>:</div><div class="line">			attempts += <span class="number">1</span></div><div class="line">			<span class="keyword">print</span> <span class="string">"error finding speciesCode of sensors"</span></div><div class="line">	</div><div class="line"></div><div class="line">	<span class="keyword">return</span> speciesCode</div><div class="line"></div><div class="line"><span class="comment"># Finally once we have the sensors associated with the closest air quality sensor we can do a check of the last day and return an average of the readings</span></div><div class="line"><span class="comment"># I realise here it would be nice to check the current time and return it as a variable for input, will work on that on day 8</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sensorReadings</span><span class="params">()</span>:</span></div><div class="line">	siteCode = distance()</div><div class="line">	speciesCode = whatSensor()</div><div class="line">	attempts = <span class="number">0</span> </div><div class="line">	averageOut  = []</div><div class="line"></div><div class="line">	<span class="keyword">for</span> key <span class="keyword">in</span> speciesCode:</div><div class="line">		speciesUrl = key[<span class="string">'SpeciesCode'</span>]</div><div class="line">		url = <span class="string">"http://api.erg.kcl.ac.uk/AirQuality/Data/SiteSpecies/SiteCode="</span>+siteCode+<span class="string">"/SpeciesCode="</span>+speciesUrl+<span class="string">"/StartDate=05-12-15/EndDate=06-12-15/Json"</span> <span class="comment"># Gives data in closest AQ monitor</span></div><div class="line">		r = requests.get(url).json() <span class="comment"># Make a request to the LAQN API for data</span></div><div class="line"></div><div class="line">		rLoop = r[<span class="string">'RawAQData'</span>][<span class="string">'Data'</span>]</div><div class="line">		AQugm3 = [] </div><div class="line"></div><div class="line">		<span class="keyword">for</span> key <span class="keyword">in</span> rLoop:</div><div class="line">			AQugm3temp = key[<span class="string">'@Value'</span>] </div><div class="line">			<span class="keyword">try</span>: </div><div class="line">		 		AQugm3temp = float(AQugm3temp) </div><div class="line">		 		AQugm3.append(AQugm3temp) <span class="comment"># Adds output to AQugm3 variable</span></div><div class="line">		 	<span class="comment"># Catches exceptions</span></div><div class="line">		 	<span class="keyword">except</span>:</div><div class="line">		 		<span class="keyword">print</span> <span class="string">'error in parsing, oops'</span></div><div class="line">		 		<span class="keyword">pass</span></div><div class="line">		<span class="comment"># Really simple averages. Sums all elements in the list and divides by the length of the list </span></div><div class="line">		average = sum(AQugm3) / float(len(AQugm3))</div><div class="line">		average = round(average,<span class="number">2</span>)</div><div class="line">		average=&#123;<span class="string">'SpeciesCode'</span>: speciesUrl, <span class="string">'average'</span>:average&#125;</div><div class="line">		averageOut.append(average)</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> averageOut</div><div class="line"></div><div class="line"><span class="keyword">print</span> sensorReadings()</div></pre></td></tr></table></figure>
<p>  On the code, apologies but the white spaces were not preserved when I copied it over, have a look at the github to get a more human readable version of the code.</p>
<p>  Running<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python AQProject.py SW72bx</div></pre></td></tr></table></figure></p>
<p>Gives</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[&#123;"SpeciesCode": "NO2";, "average": 43.0&#125;, &#123;"SpeciesCode: 'PM10", 'average': 21.68&#125;, &#123;'SpeciesCode': "PM25", 'average': 8.66&#125;]</div></pre></td></tr></table></figure>
<p>Turns out the air quality around work is pretty good, for NO2 43ug/m3 average is right at the 40ug/m3 target for a yearly average. Yay 🙂</p>
<p>One thing I’ve noticed from this work is I need to have a play with times and dates to do it neatly. Tomorrow I’m going to play with NTP servers and the date module in python. Its a slight divergence from the API calling but will be a useful function to plug into other functions in the future.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/07/2015/12/07/api-month-day-7-where-is-my-air/" data-id="cj7ulv36j0035utnpnjwwnk8x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-/2015/12/06/day-6-api-month-gps-distance/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/06/2015/12/06/day-6-api-month-gps-distance/" class="article-date">
  <time datetime="2015-12-06T22:42:58.000Z" itemprop="datePublished">2015-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/06/2015/12/06/day-6-api-month-gps-distance/">Day 6 API Month - GPS Distance</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>API purpose: GPS Distance</p>
<p>Signup: Using the google developer portal</p>
<p>Documentation: <a href="https://developers.google.com/maps/web-services/client-library" target="_blank" rel="external">https://developers.google.com/maps/web-services/client-library</a></p>
<p>Github: <a href="https://github.com/gregario/API-Month/tree/master/Day6%20GPS%20Distance" target="_blank" rel="external">https://github.com/gregario/API-Month/tree/master/Day6%20GPS%20Distance</a></p>
<p>Comment: Continuation of day 4, interesting problem.</p>
<p>Quick one today after yesterday drove me mad. Wanted to do a quick function that takes in two sets of GPS data and works out the distance between them. I did some reading on calculating distances between two points on a map. Apparently its a real issue in the mapping community with many implementations of map hashing being discussed.</p>
<p>My first thoughts would be to take the two latitudes from each other, take the absolute of that. Then do the same with longditude and then add those two numbers together. In math-y terms it would be:</p>
<blockquote>
<p>distance = abs(lat2 - lat1) + abs(long2 - long2)</p>
</blockquote>
<p>But then I had a flashback to my school maths and it would be more appropriate to do a pythagoras job on it. Basically take the two points as a hypotenuse of a right angled triangle. Then I had the fun of programming it in python, I got:</p>
<blockquote>
<p>math.sqrt((p0[0] - p1[0])**2 + (p0[1] - p1[1])**2)</p>
</blockquote>
<p>A small aside but another thing I did for today was to make an API key file that I can use with all my programs. So commiting your API keys to Git is generally a bad thing. People have scripts running to search for API key, particularly for anything to do with AWS, and start hammering them once they’re found. It can end up costing a bunch of money. So I have a separate file I do not commit to any Git repository and I add to my files by importing it like any other module in python. It also is a nice system for configuration files if you want to make your python scripts more abstract.</p>
<p>So new code, here it it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-T</span></div><div class="line"><span class="comment"># Program to check the linear distance between two sets of GPS coordinates. </span></div><div class="line"><span class="comment"># Continuation of day 4 of API Month</span></div><div class="line"><span class="comment"># Greg Jackson 6th deb 2015</span></div><div class="line"><span class="comment"># Twitter @gr3gario or github gregario</span></div><div class="line"><span class="comment"># Day 6 of the Month of API</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> googlemaps <span class="comment"># install using pip install -U googlemaps </span></div><div class="line"><span class="keyword">import</span> sys <span class="comment"># Used to take in input parameters from command line.</span></div><div class="line"><span class="keyword">from</span> APIKEY <span class="keyword">import</span> googlekey</div><div class="line"><span class="keyword">import</span> math <span class="comment"># Added to do sqrt </span></div><div class="line"></div><div class="line"><span class="comment"># Geocoding an address</span></div><div class="line">geocode_result = gmaps.geocode(sys.argv[<span class="number">1</span>]) <span class="comment"># passes address given on command line to google maps geocoding api</span></div><div class="line">gmaps = googlemaps.Client(key=[INSERT_KEY]googlekey) <span class="comment"># Get key from your google developer portal. </span></div><div class="line">latlng = []</div><div class="line">latlngTB = [<span class="number">51.5054564</span>,<span class="number">-0.0753565</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">for</span> key <span class="keyword">in</span> geocode_result: <span class="comment"># the returned object is a list with nested JSON objects inside each list. So you need to iterate through the list and do operations on each object separately</span></div><div class="line">	latlng.append(key[<span class="string">'geometry'</span>][<span class="string">'bounds'</span>][<span class="string">'northeast'</span>][<span class="string">'lat'</span>]) <span class="comment"># pulls out nested latitude figure from call</span></div><div class="line">	latlng.append(key[<span class="string">'geometry'</span>][<span class="string">'bounds'</span>][<span class="string">'northeast'</span>][<span class="string">'lng'</span>]) <span class="comment"># pulls out nested longditude figure from call</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">distance</span><span class="params">(p0, p1)</span>:</span></div><div class="line">    <span class="keyword">return</span> math.sqrt((p0[<span class="number">0</span>] - p1[<span class="number">0</span>])**<span class="number">2</span> + (p0[<span class="number">1</span>] - p1[<span class="number">1</span>])**<span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="comment"># Obsolete Method, simplier than other.</span></div><div class="line"><span class="comment">#distance = abs(latlngTB[0] - latlng[0]) + abs(latlng[1] - latlngTB[1]) </span></div><div class="line"></div><div class="line">distance = distance(latlng,latlngTB)</div><div class="line"><span class="keyword">print</span> <span class="string">"The distance to Tower Bridge is: "</span> +str(distance)</div></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/06/2015/12/06/day-6-api-month-gps-distance/" data-id="cj7ulv36h0031utnpunp4fu6e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-/2015/12/05/day-5-api-month-london-air-quality/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/05/2015/12/05/day-5-api-month-london-air-quality/" class="article-date">
  <time datetime="2015-12-05T16:48:47.000Z" itemprop="datePublished">2015-12-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/05/2015/12/05/day-5-api-month-london-air-quality/">Day 5 API Month - London Air Quality</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>API purpose: Getting London Air Quality Data</p>
<p>Signup: None, its open data</p>
<p>Documentation: <a href="http://api.erg.kcl.ac.uk/AirQuality/help" target="_blank" rel="external">http://api.erg.kcl.ac.uk/AirQuality/help</a></p>
<p>Github: <a href="https://github.com/gregario/API-Month/tree/master/Day5%20AirQuality" target="_blank" rel="external">https://github.com/gregario/API-Month/tree/master/Day5%20AirQuality</a></p>
<p>Comment: Really well made API, not real time though, about a day delay</p>
<p>So Kings College run an array of air quality monitors across London. Its a really interesting piece of data to work with that is so relevant to our day to day lives. Thought I would have a look at the API and try to pull the data from my nearest air quality monitor to my home.</p>
<p>The call from the API documentation requires the use of their site codes to work, which isn’t the most intuitive. A quick peruse of the maps at <a href="http://www.londonair.org.uk/LondonAir/Default.aspx" target="_blank" rel="external">particulate matter</a>. Cool so IS2 is my air quality roadside monitor. As a bonus there’s 15 years of data from the monitor.</p>
<p>So <a href="http://api.erg.kcl.ac.uk/AirQuality/help/operations/GetRawDataSitesSpeciesJSON" target="_blank" rel="external">here</a> is the link to the call we want. It actually leads to a pretty straightforward script. [Edit an hour later]. Getting strings converted to floats is apparently not straight forward. Anywho, here’s the completed script. As always I explain the crap out of the code in the code so I think it kind of explains itself!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#coding: utf-8</span></div><div class="line"><span class="comment"># Day 5 of month of API</span></div><div class="line"><span class="comment"># Looking at local air quality data and what the last 24 hours have been like in your local area</span></div><div class="line"><span class="comment"># Greg Jackson 05/12/15 gr3gario on twitter ang gregario on github</span></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> json </div><div class="line"></div><div class="line"></div><div class="line">url = <span class="string">"http://api.erg.kcl.ac.uk/AirQuality/Data/SiteSpecies/SiteCode=IS2/SpeciesCode=NO2/StartDate=04-12-15/EndDate=05-12-15/Json"</span> <span class="comment"># Gives data in closest AQ monitor</span></div><div class="line">r = requests.get(url).json() <span class="comment"># Make a request to the LAQN API for data</span></div><div class="line"></div><div class="line">rLoop = r[<span class="string">'RawAQData'</span>][<span class="string">'Data'</span>] <span class="comment"># You got to define this here as you can't nest it below. the for loop below only works for the list embedded in the JSON object</span></div><div class="line">AQugm3 = [] <span class="comment"># A list to store the readins</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">for</span> key <span class="keyword">in</span> rLoop:</div><div class="line">	AQugm3temp = key[<span class="string">'@Value'</span>] <span class="comment"># This loops through each data packet in the list and pulls out our relevant datapoint</span></div><div class="line">	<span class="keyword">try</span>: <span class="comment"># A try catch is included here as there are blank datapoints returned from the LAQN API that would mess this up occasionally if there wasn't a catch in place</span></div><div class="line">		AQugm3temp = float(AQugm3temp) <span class="comment"># Converts from a string to a float so we can perform operations on it</span></div><div class="line">		AQugm3.append(AQugm3temp) <span class="comment"># Adds output to AQugm3 variable</span></div><div class="line">	<span class="comment"># Catches exceptions</span></div><div class="line">	<span class="keyword">except</span>:</div><div class="line">		<span class="keyword">print</span> <span class="string">'error in parsing, oops'</span></div><div class="line">		<span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="comment"># Really simple averages. Sums all elements in the list and divides by the length of the list </span></div><div class="line">average = sum(AQugm3) / float(len(AQugm3))</div><div class="line">average = round(average,<span class="number">2</span>)</div><div class="line"><span class="comment"># This is an EU defined goal for NO2 in the city. I figure if our daily average is below this we're doing well. Its more to give context to the number.</span></div><div class="line">goal = <span class="number">40.0</span> </div><div class="line"></div><div class="line"><span class="comment"># Simple check to give context to the number. </span></div><div class="line"><span class="keyword">if</span> average &lt; goal:</div><div class="line">	<span class="keyword">print</span> <span class="string">"Hurray! The air quality today is less than the yearly average target of 40 ug/m3 NO2 target in the UK and reads "</span> +str(average)+ <span class="string">" ug/m3"</span></div><div class="line"><span class="keyword">elif</span> average &gt; goal: </div><div class="line">	<span class="keyword">print</span> <span class="string">"Unfortunately the air quality today is more than the yearly average target of 40 ug/m3 NO2 in the UK and reads "</span> + str(average)+ <span class="string">" ug/m3"</span></div></pre></td></tr></table></figure>
<p>So when I run python AQ.py.</p>
<blockquote>
<p>Unfortunately the air quality today is more than the yearly average target of 40 ug/m3 NO2 in the UK and reads 69.71 ug/m3</p>
</blockquote>
<p>Interesting stuff 🙂</p>
<p>So I had the thought of making a bigger project at the end of each week, not necessarily more work but wrapping up the work I’ve done into one bigger program. I have a good idea to wrap this weeks work up which I’ll explain on Monday but its missing one big element. I need to be able to easily calculate the distance between two sets of GPS coordinates. So tomorrow I’ll work on this. I’ll be pulling an address in the UK, converting to GPS data and checking its linear distance to tower bridge in London.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/05/2015/12/05/day-5-api-month-london-air-quality/" data-id="cj7ulv36k0039utnp9052azfy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-/2015/12/04/day-4-api-month-google-maps-geocoding/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/04/2015/12/04/day-4-api-month-google-maps-geocoding/" class="article-date">
  <time datetime="2015-12-04T18:05:13.000Z" itemprop="datePublished">2015-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/04/2015/12/04/day-4-api-month-google-maps-geocoding/">Day 4 API Month - Google Maps Geocoding</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>API purpose: Getting GPS data (amongst a bunch of other things)</p>
<p>Signup: Via your google account.</p>
<p>Documentation: <a href="https://developers.google.com/maps/web-services/client-library" target="_blank" rel="external">https://developers.google.com/maps/web-services/client-library</a></p>
<p>Github:<a href="https://github.com/gregario/API-Month/tree/master/Day4%20GPS" target="_blank" rel="external"> https://github.com/gregario/API-Month/tree/master/Day4%20GPS</a></p>
<p>Comment: Easy Peasy!</p>
<p>A super simple one today. Working through these location maps I’ve had to input GPS coordinates for a call and I thought it would be nice to be able to feed in a nice address and get a nice GPS coordinates. Turns out google provide this service and its super easy to use.</p>
<p>So I looked at a function for geocoding (taking an address and converting to GPS), this can be simply altered for reverse geocoding too (taking GPS and converting to an address). The latter is important too as some functions in API’s return a GPS and its not meaningful as an output (or nobody knows what the hell it means.</p>
<p>So the code today is super simple as a nice man made a python wrapper for all of this. So rock over to <a href="https://github.com/googlemaps/google-maps-services-python" target="_blank" rel="external">https://github.com/googlemaps/google-maps-services-python</a> or just run:</p>
<blockquote>
<p>sudo pip install -U googlemaps</p>
</blockquote>
<p>You are basically good to go then. So I wrote two short scripts that are available on the github link above, the scripts are pretty easy and build on the python tricks I built up in the other tutorials.</p>
<p><a href="/wp-content/uploads/2015/12/JSON_Day4.jpg">JSON_Day4</a></p>
<p>Here’s the API call, very similar structure to the TFL structure!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># Program to check how long it will take me to get to work</span></div><div class="line"><span class="comment"># Greg Jackson 4th deb 2015</span></div><div class="line"><span class="comment"># Twitter @gr3gario or github gregario</span></div><div class="line"><span class="comment"># Day four of the Month of API</span></div><div class="line"></div><div class="line">import googlemaps <span class="comment"># install using pip install -U googlemaps </span></div><div class="line">import sys <span class="comment"># Used to take in input parameters from command line.</span></div><div class="line"></div><div class="line">gmaps = googlemaps.Client(key=<span class="string">'INSERT API KEY'</span>) <span class="comment"># Get key from your google developer portal. </span></div><div class="line"></div><div class="line"><span class="comment"># Geocoding an address</span></div><div class="line">geocode_result = gmaps.geocode(sys.argv[1]) <span class="comment"># passes address given on command line to google maps geocoding api</span></div><div class="line">latlng = []</div><div class="line"></div><div class="line"><span class="keyword">for</span> key <span class="keyword">in</span> geocode_result: <span class="comment"># the returned object is a list with nested JSON objects inside each list. So you need to iterate through the list and do operations on each object separately</span></div><div class="line">	latlng.append(key[<span class="string">'geometry'</span>][<span class="string">'bounds'</span>][<span class="string">'northeast'</span>][<span class="string">'lat'</span>]) <span class="comment"># pulls out nested latitude figure from call</span></div><div class="line">	latlng.append(key[<span class="string">'geometry'</span>][<span class="string">'bounds'</span>][<span class="string">'northeast'</span>][<span class="string">'lng'</span>]) <span class="comment"># pulls out nested longditude figure from call</span></div><div class="line"></div><div class="line"><span class="comment"># easy peasy printing</span></div><div class="line"><span class="built_in">print</span> <span class="string">"Your latitude is: "</span> +latlng[0]</div><div class="line"><span class="built_in">print</span> <span class="string">"Your londitude is: "</span> +latlng[1]</div></pre></td></tr></table></figure>
<p>And it works! Go me.</p>
<p><a href="/wp-content/uploads/2015/12/day4-success.jpg">day4 success</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/04/2015/12/04/day-4-api-month-google-maps-geocoding/" data-id="cj7ulv36g002yutnpimvev6ze" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-/2015/12/04/api-month-day-3-tfl-api/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/04/2015/12/04/api-month-day-3-tfl-api/" class="article-date">
  <time datetime="2015-12-04T17:00:33.000Z" itemprop="datePublished">2015-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/04/2015/12/04/api-month-day-3-tfl-api/">API Month Day 3 - TFL API</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>API purpose: Commuting Data</p>
<p>Signup: No Signup</p>
<p>Documentation: <a href="https://api-portal.tfl.gov.uk/docs" target="_blank" rel="external">https://api-portal.tfl.gov.uk/docs</a></p>
<p>Github: <a href="https://github.com/gregario/API-Month/tree/master/Day3%20Maps" target="_blank" rel="external">https://github.com/gregario/API-Month/tree/master/Day3%20Maps </a> Comment: surprisingly challenging</p>
<p>So as I said yesterday today I want to find the arrival time of my local train so I can plan my morning breakfast intake! It turned out to be quite challenging… Firstly a comment on the TFL (transport for london) API services. They’re all over the place. I found the following resources to extract data about journeys, stop locations and times:</p>
<p><a href="https://api.tfl.gov.uk/#Journey" target="_blank" rel="external">https://api.tfl.gov.uk/#Journey</a></p>
<p><a href="http://countdown.tfl.gov.uk/" target="_blank" rel="external">http://countdown.tfl.gov.uk/</a></p>
<p>and two sets of documentation at:</p>
<p><a href="https://api-portal.tfl.gov.uk/docs" target="_blank" rel="external">https://api-portal.tfl.gov.uk/docs</a></p>
<p><a href="https://api.tfl.gov.uk/" target="_blank" rel="external">https://api.tfl.gov.uk/</a></p>
<p>So I eventually used the API portal to get access to arrival times, it wasn’t the most straightforward information set to work with however. Check out the photo!</p>
<p><a href="/wp-content/uploads/2015/12/JSON_TFL.jpg">JSON_TFL</a></p>
<p>The photo shows a typical API response from a station arrival time call. We want one variable from this giant list! This is a good time to work with a list like this as many API’s are complex like this one so it gives me an opportunity to go through the detail and figure out how to extract the data.</p>
<p>I got to play with some good stuff here such as operating on, iterating over and extracting conditional data from JSON objects. Also doing operations on time while pulling the current real time from the python datetime module.</p>
<p>The key for the code here is that the API is a list where each element in the list is a JSON object (that we manipulate as a python dict). Confused? I was… But its OK to work with in practice. What happens here is we write some code to loop through the list and for every JSON element in the list do a value search for arrival time. This gives us the arrival time of all trains into my station. However I only want certain trains heading in one direction. So I run an if with the loop checking for the relevant trains. If they are present pop the arrival time from that train into a new array. Then we have an array with all the relevant arrival times. Just sort that and you have the train that will arrive first. Pop that out and you have a variable to work with. YAY. Taking that from the current time gives you the number you are looking for.</p>
<p>I’ve explained the logic of what I want to do now let’s look at the code. If you are reading this (I do doubt anyone is) I am trying to improve the way in which I write these tutorials. Today I’m trying to explain how all the code works as comments. Hopefully one can understand how it works just from that.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># Program to check how long it will take me to get to work</span></div><div class="line"><span class="comment"># Greg Jackson 1st dev 2015</span></div><div class="line"><span class="comment"># Twitter @gr3gario or github gregario</span></div><div class="line"><span class="comment"># Day one of the Month of API</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> json </div><div class="line"><span class="keyword">import</span> sys <span class="comment"># needed to pass arguments from command line </span></div><div class="line"><span class="keyword">import</span> datetime </div><div class="line"></div><div class="line">url = <span class="string">"https://api.tfl.gov.uk/StopPoint/910grctryrd/arrivals"</span> <span class="comment"># the stop number is returned from the TFL website from a manual search. This calls the data</span></div><div class="line">r = requests.get(url).json() <span class="comment"># Make a request to the TFL API for data</span></div><div class="line">time = [] <span class="comment"># List for my future train arrivals</span></div><div class="line"><span class="keyword">for</span> key <span class="keyword">in</span> r: <span class="comment"># the returned object is a list with nested JSON objects inside each list. So you need to iterate through the list and do operations on each object separately</span></div><div class="line">	<span class="keyword">if</span> key[<span class="string">'destinationName'</span>] == (<span class="string">"Cheshunt Rail Station"</span>) <span class="keyword">or</span> (<span class="string">"Enfield Town Rail Station"</span>): <span class="comment"># This filters out trains to different destinations. I can take either of these trains</span></div><div class="line">		time.append(key[<span class="string">'expectedArrival'</span>])  <span class="comment"># Adds expected arrival time from each train data structure to the time list</span></div><div class="line"></div><div class="line">time_sorted = sorted(time) <span class="comment"># sorts the time list so we get the train due to arrive first</span></div><div class="line">time_train = time_sorted.pop(<span class="number">0</span>) <span class="comment"># pops out the first train to arrive and stores as a string</span></div><div class="line">§</div><div class="line"></div><div class="line"><span class="comment"># this translates the time from a string in the list to a usable string, taking out the date. </span></div><div class="line"><span class="comment"># A note on how I deal with the date and time operations here. </span></div><div class="line"><span class="comment"># Its TERRIBLE. it works but I'm sure there's a much cleaner way of doing this. </span></div><div class="line">time_train_temp = time_train.split(<span class="string">'T'</span>,<span class="number">1</span>)[<span class="number">-1</span>]</div><div class="line">time_train_parsed = time_train_temp.split(<span class="string">'.'</span>,<span class="number">1</span>)[<span class="number">0</span>]</div><div class="line"></div><div class="line">current_time = str(datetime.datetime.now())</div><div class="line">current_time_temp = current_time.split(<span class="string">' '</span>,<span class="number">1</span>)[<span class="number">-1</span>]</div><div class="line">current_time_parsed = current_time_temp.split(<span class="string">'.'</span>,<span class="number">1</span>)[<span class="number">0</span>]</div><div class="line"><span class="comment">#print  k</span></div><div class="line"></div><div class="line"><span class="comment"># Converts the two hour:minute:second strings back into time variables. </span></div><div class="line">timeA = datetime.datetime.strptime(time_train_parsed, <span class="string">'%H:%M:%S'</span>)  </div><div class="line">timeB = datetime.datetime.strptime(current_time_parsed, <span class="string">'%H:%M:%S'</span>) </div><div class="line"></div><div class="line"><span class="comment"># Takes the time of the next train away from the current time to give an estimated time until arrival of the next train I can take </span></div><div class="line">time_delta = timeA-timeB</div><div class="line"><span class="keyword">print</span> (<span class="string">"The next train to work will arrive in "</span> +str(time_delta))</div></pre></td></tr></table></figure>
<p>And it works!</p>
<p><a href="/wp-content/uploads/2015/12/Output_day3.jpg">Output_day3</a></p>
<p>I’ve never been so happy to see some command line arguments! This was day three but I ran over time so I’m going to immediately do day 4 too 🙂 Stay tuned.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/04/2015/12/04/api-month-day-3-tfl-api/" data-id="cj7ulv36f002wutnpi69l4905" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-/2015/12/02/api-month-day-2-weather-underground/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/02/2015/12/02/api-month-day-2-weather-underground/" class="article-date">
  <time datetime="2015-12-02T16:24:23.000Z" itemprop="datePublished">2015-12-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Uncategorised/">Uncategorised</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/02/2015/12/02/api-month-day-2-weather-underground/">API Month Day 2 - Weather Underground</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Highlights</strong></p>
<p><strong>API purpose:</strong> Weather Conditions</p>
<p><strong>Signup: </strong><a href="http://www.wunderground.com/weather/api/" target="_blank" rel="external">http://www.wunderground.com/weather/api/</a></p>
<p><strong>Documentation:</strong> <a href="http://www.wunderground.com/weather/api/d/docs" target="_blank" rel="external">http://www.wunderground.com/weather/api/d/docs</a><br><strong>Github:</strong> <a href="http://bit.ly/1OxwFrc" target="_blank" rel="external">http://bit.ly/1OxwFrc</a></p>
<blockquote>
<p><strong>Comment:</strong> Feature rich and worldwide weather!</p>
</blockquote>
<p>OK so day two of API month. Exciting, right? Yesterday it occured to me if I’m making a decision when debating my cycle vs tube debate it would also be good to see the near term forecast. So I did some reading and found weather underground. Its a system of weather stations around the world, with data provided by official and hobbyist sources. Their API is pretty good too!</p>
<p><strong>Getting the Data</strong></p>
<p>So I swung over and setup an account. Straight forward process. I want to pull relevant information from the API so I did a sample call for London to see what I would get.</p>
<blockquote>
<p><a href="http://api.wunderground.com/api/[INSERTKEY]/conditions/q/uk/London.json" target="_blank" rel="external">http://api.wunderground.com/api/[INSERTKEY]/conditions/q/uk/London.json</a></p>
</blockquote>
<p>Pretty straightforward. A slightly different system than citymapper but very usable. It returned this: ``</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"response"</span>: &#123;</div><div class="line">      <span class="attr">"version"</span>:<span class="string">"0.1"</span>,</div><div class="line">      <span class="attr">"termsofService"</span>:<span class="string">"http://www.wunderground.com/weather/api/d/terms.html"</span>,</div><div class="line">      <span class="attr">"features"</span>: &#123;</div><div class="line">        <span class="attr">"conditions"</span>: <span class="number">1</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  , <span class="attr">"current_observation"</span>: &#123;</div><div class="line">        <span class="attr">"image"</span>: &#123;</div><div class="line">        <span class="attr">"url"</span>:<span class="string">"http://icons.wxug.com/graphics/wu2/logo_130x80.png"</span>,</div><div class="line">        <span class="attr">"title"</span>:<span class="string">"Weather Underground"</span>,</div><div class="line">        <span class="attr">"link"</span>:<span class="string">"http://www.wunderground.com"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"display_location"</span>: &#123;</div><div class="line">        <span class="attr">"full"</span>:<span class="string">"Dublin, Ireland"</span>,</div><div class="line">        <span class="attr">"city"</span>:<span class="string">"Dublin"</span>,</div><div class="line">        <span class="attr">"state"</span>:<span class="string">""</span>,</div><div class="line">        <span class="attr">"state_name"</span>:<span class="string">"Ireland"</span>,</div><div class="line">        <span class="attr">"country"</span>:<span class="string">"IE"</span>,</div><div class="line">        <span class="attr">"country_iso3166"</span>:<span class="string">"IE"</span>,</div><div class="line">        <span class="attr">"zip"</span>:<span class="string">"00000"</span>,</div><div class="line">        <span class="attr">"magic"</span>:<span class="string">"1"</span>,</div><div class="line">        <span class="attr">"wmo"</span>:<span class="string">"03969"</span>,</div><div class="line">        <span class="attr">"latitude"</span>:<span class="string">"53.43000031"</span>,</div><div class="line">        <span class="attr">"longitude"</span>:<span class="string">"-6.25000000"</span>,</div><div class="line">        <span class="attr">"elevation"</span>:<span class="string">"85.00000000"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"observation_location"</span>: &#123;</div><div class="line">        <span class="attr">"full"</span>:<span class="string">"Paulie - Swords West, Swords, DUBLIN"</span>,</div><div class="line">        <span class="attr">"city"</span>:<span class="string">"Paulie - Swords West, Swords"</span>,</div><div class="line">        <span class="attr">"state"</span>:<span class="string">"DUBLIN"</span>,</div><div class="line">        <span class="attr">"country"</span>:<span class="string">"IRELAND"</span>,</div><div class="line">        <span class="attr">"country_iso3166"</span>:<span class="string">"IE"</span>,</div><div class="line">        <span class="attr">"latitude"</span>:<span class="string">"53.463554"</span>,</div><div class="line">        <span class="attr">"longitude"</span>:<span class="string">"-6.249463"</span>,</div><div class="line">        <span class="attr">"elevation"</span>:<span class="string">"138 ft"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"estimated"</span>: &#123;</div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"station_id"</span>:<span class="string">"IDUBLINS3"</span>,</div><div class="line">        <span class="attr">"observation_time"</span>:<span class="string">"Last Updated on December 2, 4:08 PM GMT"</span>,</div><div class="line">        <span class="attr">"observation_time_rfc822"</span>:<span class="string">"Wed, 02 Dec 2015 16:08:49 +0000"</span>,</div><div class="line">        <span class="attr">"observation_epoch"</span>:<span class="string">"1449072529"</span>,</div><div class="line">        <span class="attr">"local_time_rfc822"</span>:<span class="string">"Wed, 02 Dec 2015 16:09:02 +0000"</span>,</div><div class="line">        <span class="attr">"local_epoch"</span>:<span class="string">"1449072542"</span>,</div><div class="line">        <span class="attr">"local_tz_short"</span>:<span class="string">"GMT"</span>,</div><div class="line">        <span class="attr">"local_tz_long"</span>:<span class="string">"Europe/Dublin"</span>,</div><div class="line">        <span class="attr">"local_tz_offset"</span>:<span class="string">"+0000"</span>,</div><div class="line">        <span class="attr">"weather"</span>:<span class="string">"Mostly Cloudy"</span>,</div><div class="line">        <span class="attr">"temperature_string"</span>:<span class="string">"51.1 F (10.6 C)"</span>,</div><div class="line">        <span class="attr">"temp_f"</span>:<span class="number">51.1</span>,</div><div class="line">        <span class="attr">"temp_c"</span>:<span class="number">10.6</span>,</div><div class="line">        <span class="attr">"relative_humidity"</span>:<span class="string">"99%"</span>,</div><div class="line">        <span class="attr">"wind_string"</span>:<span class="string">"Calm"</span>,</div><div class="line">        <span class="attr">"wind_dir"</span>:<span class="string">"SW"</span>,</div><div class="line">        <span class="attr">"wind_degrees"</span>:<span class="number">217</span>,</div><div class="line">        <span class="attr">"wind_mph"</span>:<span class="number">0.0</span>,</div><div class="line">        <span class="attr">"wind_gust_mph"</span>:<span class="number">0</span>,</div><div class="line">        <span class="attr">"wind_kph"</span>:<span class="number">0</span>,</div><div class="line">        <span class="attr">"wind_gust_kph"</span>:<span class="number">0</span>,</div><div class="line">        <span class="attr">"pressure_mb"</span>:<span class="string">"1017"</span>,</div><div class="line">        <span class="attr">"pressure_in"</span>:<span class="string">"30.04"</span>,</div><div class="line">        <span class="attr">"pressure_trend"</span>:<span class="string">"+"</span>,</div><div class="line">        <span class="attr">"dewpoint_string"</span>:<span class="string">"51 F (11 C)"</span>,</div><div class="line">        <span class="attr">"dewpoint_f"</span>:<span class="number">51</span>,</div><div class="line">        <span class="attr">"dewpoint_c"</span>:<span class="number">11</span>,</div><div class="line">        <span class="attr">"heat_index_string"</span>:<span class="string">"NA"</span>,</div><div class="line">        <span class="attr">"heat_index_f"</span>:<span class="string">"NA"</span>,</div><div class="line">        <span class="attr">"heat_index_c"</span>:<span class="string">"NA"</span>,</div><div class="line">        <span class="attr">"windchill_string"</span>:<span class="string">"NA"</span>,</div><div class="line">        <span class="attr">"windchill_f"</span>:<span class="string">"NA"</span>,</div><div class="line">        <span class="attr">"windchill_c"</span>:<span class="string">"NA"</span>,</div><div class="line">        <span class="attr">"feelslike_string"</span>:<span class="string">"51.1 F (10.6 C)"</span>,</div><div class="line">        <span class="attr">"feelslike_f"</span>:<span class="string">"51.1"</span>,</div><div class="line">        <span class="attr">"feelslike_c"</span>:<span class="string">"10.6"</span>,</div><div class="line">        <span class="attr">"visibility_mi"</span>:<span class="string">"6.2"</span>,</div><div class="line">        <span class="attr">"visibility_km"</span>:<span class="string">"10.0"</span>,</div><div class="line">        <span class="attr">"solarradiation"</span>:<span class="string">"0"</span>,</div><div class="line">        <span class="attr">"UV"</span>:<span class="string">"0.0"</span>,<span class="attr">"precip_1hr_string"</span>:<span class="string">"0.00 in ( 0 mm)"</span>,</div><div class="line">        <span class="attr">"precip_1hr_in"</span>:<span class="string">"0.00"</span>,</div><div class="line">        <span class="attr">"precip_1hr_metric"</span>:<span class="string">" 0"</span>,</div><div class="line">        <span class="attr">"precip_today_string"</span>:<span class="string">"0.07 in (2 mm)"</span>,</div><div class="line">        <span class="attr">"precip_today_in"</span>:<span class="string">"0.07"</span>,</div><div class="line">        <span class="attr">"precip_today_metric"</span>:<span class="string">"2"</span>,</div><div class="line">        <span class="attr">"icon"</span>:<span class="string">"mostlycloudy"</span>,</div><div class="line">        <span class="attr">"icon_url"</span>:<span class="string">"http://icons.wxug.com/i/c/k/mostlycloudy.gif"</span>,</div><div class="line">        <span class="attr">"forecast_url"</span>:<span class="string">"http://www.wunderground.com/global/stations/03969.html"</span>,</div><div class="line">        <span class="attr">"history_url"</span>:<span class="string">"http://www.wunderground.com/weatherstation/WXDailyHistory.asp?ID=IDUBLINS3"</span>,</div><div class="line">        <span class="attr">"ob_url"</span>:<span class="string">"http://www.wunderground.com/cgi-bin/findweather/getForecast?query=53.463554,-6.249463"</span>,</div><div class="line">        <span class="attr">"nowcast"</span>:<span class="string">""</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Wow… That is a lot more info than our last tutorial. This is great though, it gives me a chance to play with more information. Here’s what I wrote up.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="comment"># Program to check how long it will take me to get to work</span></div><div class="line"><span class="comment"># Greg Jackson 1st dev 2015</span></div><div class="line"><span class="comment"># Twitter @gr3gario or github gregario</span></div><div class="line"><span class="comment"># Day one of the Month of API</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> json </div><div class="line"><span class="keyword">import</span> sys <span class="comment"># needed to pass arguments from command line </span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">country=  str(sys.argv[<span class="number">1</span>])</div><div class="line">location = str(sys.argv[<span class="number">2</span>])</div><div class="line">url = <span class="string">"http://api.wunderground.com/api/[INSERTAPIKEY]/conditions/q/"</span>+str(country)+<span class="string">"/"</span>+str(location)+<span class="string">".json"</span></div><div class="line"></div><div class="line">r = requests.get(url).json()</div><div class="line">print(<span class="string">"The current wind speed (mph) is: "</span>+ str(r[<span class="string">'current_observation'</span>][<span class="string">'wind_mph'</span>]))</div><div class="line">print(<span class="string">"The current temperature (C) is: "</span> +str(r[<span class="string">'current_observation'</span>][<span class="string">'temp_c'</span>]))</div><div class="line">print(<span class="string">"Sure what's the weather like? : "</span>+ str(r[<span class="string">'current_observation'</span>][<span class="string">'icon'</span>]))</div><div class="line">print(<span class="string">"The current relative RH is: "</span>+str(r[<span class="string">'current_observation'</span>][<span class="string">'relative_humidity'</span>]))</div><div class="line">print(<span class="string">"Will it rain soon? : "</span>+str(r[<span class="string">'current_observation'</span>][<span class="string">'precip_1hr_metric'</span>]))</div><div class="line"></div><div class="line"><span class="comment"># So I have a good indication of the weather from a current loation. </span></div><div class="line"><span class="comment"># I introduced two super simple things here. </span></div><div class="line"><span class="comment"># One is string concatonation in python. This lets us declare a location by variable instead of in line. </span></div><div class="line"><span class="comment"># this can be better than the payload option as it gives you more flexibility. </span></div><div class="line"></div><div class="line"><span class="comment">## Finally I thought I could declare from the command line the location to search. </span></div><div class="line"><span class="comment">## I've always wondered how this could be done so now I know!</span></div></pre></td></tr></table></figure>
<p>Still pretty straightforward too!</p>
<p><strong>Nested JSON</strong></p>
<p>Yesterday our JSON was super easy. It was one series of machine tag pairs inside a JSON object. We asked for our machine tag (estimated_time) in that array and we were good to go with the value associated with that. However in JSON, each variable in an array can have an array of machine tags nested inside it. Its actually quite elegant if you work through the logic but we don’t care about this, we just want the data, right?!!! So let’s take wind speed from above. We wanted to get the current_observation array and inside that get the wind_mph tag and its associated value. To do this we used the following syntax.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">print(<span class="string">"The current wind speed (mph) is: "</span>+ str(r\[<span class="string">'current\_observation'</span>\]\[<span class="string">'wind\_mph'</span>\]))</div></pre></td></tr></table></figure>
<p><strong>So What Next? </strong></p>
<p>So that’s that for today. Another simple example with some useful tricks to get you going with weather APIs. So what shall I do tomorrow??? I like this work around my commute to work. I think I’m going to solve a final challenge tomorrow with a good one, I live a 4 minute walk from my local train to work. The train comes every 15 minutes. The arrival time of the next train dictates if I have breakfast each day. I check this every day on google maps so I want to write a script that checks the TFL API and displays the next train time for me so I can quickly glance and see how long I have!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://thebedlab.com/2015/12/02/2015/12/02/api-month-day-2-weather-underground/" data-id="cj7ulv36d002sutnpnr3ptl3d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/">API</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">next &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/Projects/">Projects</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maker/">Maker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Projects/">Projects</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Projects/School-Night-Sessions/">School Night Sessions</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Projects/Tutorials/">Tutorials</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/School-Night-Sessions/">School Night Sessions</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/The-Lab/">The Lab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorials/">Tutorials</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorised/">Uncategorised</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/API/">API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Arduino/">Arduino</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Beginner/">Beginner</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Digital-Week/">Digital Week</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Doodlebot/">Doodlebot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Drinking/">Drinking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ESP8266/">ESP8266</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Homebrew/">Homebrew</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IoT/">IoT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lasercutter/">Lasercutter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Month/">Month</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REST-API/">REST API</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reflow-Soldering-Oven/">Reflow Soldering Oven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Workshop/">Workshop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homemade-equipment/">homemade equipment</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/API/" style="font-size: 20px;">API</a> <a href="/tags/Arduino/" style="font-size: 13.33px;">Arduino</a> <a href="/tags/Beginner/" style="font-size: 13.33px;">Beginner</a> <a href="/tags/Digital-Week/" style="font-size: 16.67px;">Digital Week</a> <a href="/tags/Doodlebot/" style="font-size: 10px;">Doodlebot</a> <a href="/tags/Drinking/" style="font-size: 10px;">Drinking</a> <a href="/tags/ESP8266/" style="font-size: 10px;">ESP8266</a> <a href="/tags/Homebrew/" style="font-size: 10px;">Homebrew</a> <a href="/tags/IoT/" style="font-size: 10px;">IoT</a> <a href="/tags/Lasercutter/" style="font-size: 10px;">Lasercutter</a> <a href="/tags/Month/" style="font-size: 10px;">Month</a> <a href="/tags/REST-API/" style="font-size: 10px;">REST API</a> <a href="/tags/Reflow-Soldering-Oven/" style="font-size: 10px;">Reflow Soldering Oven</a> <a href="/tags/Workshop/" style="font-size: 16.67px;">Workshop</a> <a href="/tags/homemade-equipment/" style="font-size: 10px;">homemade equipment</a> <a href="/tags/tutorial/" style="font-size: 16.67px;">tutorial</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/06/07/api-month-day-11-movies/">API Month Day 11 - Movies</a>
          </li>
        
          <li>
            <a href="/2015/12/10/api-month-day-10-twitter-mood/">API Month Day 10 - Oasis or Blur</a>
          </li>
        
          <li>
            <a href="/2015/12/09/2015/12/09/api-month-day-9-petrol-stations/">API Month Day 9 - Petrol Stations</a>
          </li>
        
          <li>
            <a href="/2015/12/08/2015/12/08/api-month-day-8-space/">API Month Day 8 - SPACE</a>
          </li>
        
          <li>
            <a href="/2015/12/07/2015/12/07/api-month-day-7-where-is-my-air/">API Month Day 7 - Where is my air?</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 The Bedroom Laboratory<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>